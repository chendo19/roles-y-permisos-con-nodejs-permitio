import{c as g,o as f,a as e,t as x,h as $,r as y,i as m,b as V,j as h,k as q,F as L,l as B,n as _,d as F,m as S,e as D,p as N,f as O}from"./index--K2Yny0p.js";const j=["disabled"],A=["disabled"],I={__name:"SinglePost",props:{index:{type:Number,required:!0},post:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},emits:["deleteHandler","editHandler"],setup(o,{emit:d}){const p=d,i=({post:l,index:s})=>{p("deleteHandler",{post:l,index:s})},v=({post:l,index:s})=>{p("editHandler",{post:l,index:s})};return(l,s)=>(f(),g("tr",null,[e("td",null,x(o.post.title),1),e("td",null,x(o.post.content),1),e("td",null,[e("button",{class:"btn btn-primary",disabled:o.isLoading,onClick:s[0]||(s[0]=u=>v({post:o.post,index:o.index}))},"Edit",8,j)]),e("td",null,[e("button",{class:"btn btn-danger",disabled:o.isLoading,onClick:s[1]||(s[1]=u=>i({post:o.post,index:o.index}))},"Delete",8,A)])]))}},U={class:"container my-5"},z={class:"row mb-3"},M={class:"col-4"},G={class:"row"},R={class:"table"},J={class:"form-modal--header"},K={class:"form-modal--footer"},W={__name:"Posts",setup(o){const{axiosCall:d,isLoading:p}=$(),i=y([]),v=m(document.getElementById("loading-line")),l=m(!1),s=m(null),u=m(null),c=m("new"),n=y({title:"",content:""}),P=y({size:"md",displayErrors:!1,schema:{title:{type:"text",inputType:"text",label:"Title",attrs:{autofocus:!0},rules:["required","min:10","max:50"],fieldName:"title"},content:{type:"text",inputType:"text",label:"Content",rules:["required","max:255"],fieldName:"content"},submit:{type:"button",submits:!0,buttonLabel:"Submit",full:!0}}});V(async()=>{try{v.value.classList.remove("hidden");const t=await d("GET","/posts/get-all",{},{withCredentials:!0});t!=null&&t.success&&i.push(...t.data)}catch(t){h({type:"error",messages:t.message})}finally{v.value.classList.add("hidden")}});const k=async({post:t,index:a})=>{const r=await d("DELETE",`/posts/delete/${t._id}`,{},{withCredentials:!0});r!=null&&r.success&&(i.splice(a,1),h({type:"success",messages:r.message}))},w=q({get(){return n},set(t){Object.assign(n,t)}}),C=()=>{l.value=!1,n.title="",n.content="",s.value=null,u.value=null,c.value="new"},E=async({post:t,index:a})=>{l.value=!0,n.title=t.title,n.content=t.content,s.value=t._id,u.value=a,c.value="edit"},T=async()=>{let t;c.value==="new"?t=await d("POST","/posts/create",n,{withCredentials:!0}):t=await d("PATCH",`/posts/update/${s.value}`,n,{withCredentials:!0}),t!=null&&t.success&&(c.value==="new"?i.push({title:n.title,content:n.content}):(i[u.value].title=n.title,i[u.value].content=n.content),C(),h({type:"success",messages:t.message}))};return(t,a)=>{const r=D("Vueform");return f(),g(L,null,[e("div",U,[e("div",z,[e("div",M,[e("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=b=>l.value=!0)},"Add User")])]),e("div",G,[e("table",R,[a[2]||(a[2]=e("thead",null,[e("tr",null,[e("th",null,"Title"),e("th",null,"Content"),e("th"),e("th")])],-1)),e("tbody",null,[(f(!0),g(L,null,B(i,(b,H)=>(f(),N(I,{key:H,index:H,post:b,isLoading:O(p),onDeleteHandler:k,onEditHandler:E},null,8,["index","post","isLoading"]))),128))])])])]),e("div",{class:_(["modal-backdrop",l.value?"show":""])},null,2),e("div",{class:_(["form-modal",l.value?"show":""])},[e("div",J,[e("h3",null,x(c.value.toUpperCase())+" POST",1),e("button",{onClick:C,class:"btn-close"})]),e("div",K,[F(r,S(P,{endpoint:!1,onSubmit:T,modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=b=>w.value=b),sync:""}),null,16,["modelValue"])])],2)],64)}}};export{W as default};
