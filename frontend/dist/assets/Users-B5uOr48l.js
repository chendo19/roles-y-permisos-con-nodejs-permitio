import{c as $,o as H,a as e,t as d,h as q,r as C,i as y,b as B,j as h,k as F,F as E,l as I,n as L,d as N,m as S,e as M,p as j,f as A}from"./index--K2Yny0p.js";const O=["disabled"],z=["disabled"],G=["disabled"],J={__name:"SingleUser",props:{index:{type:Number,required:!0},user:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},emits:["deleteHandler","roleHandler","editHandler"],setup(l,{emit:m}){const f=m,i=({user:r,index:a})=>{f("deleteHandler",{user:r,index:a})},g=({user:r,index:a})=>{f("editHandler",{user:r,index:a})},c=({userDbId:r,userPermitID:a,currentRole:o,newRole:b,index:n})=>{f("roleHandler",{userDbId:r,userPermitID:a,currentRole:o,newRole:b,index:n})};return(r,a)=>(H(),$("tr",null,[e("td",null,d(l.user.name),1),e("td",null,d(l.user.email),1),e("td",null,d(l.user.role.toUpperCase()),1),e("td",null,[e("button",{class:"btn btn-primary",disabled:l.isLoading,onClick:a[0]||(a[0]=o=>g({user:l.user,index:l.index}))},d(r.$t("edit")),9,O)]),e("td",null,[e("button",{class:"btn btn-danger",disabled:l.isLoading,onClick:a[1]||(a[1]=o=>i({user:l.user,index:l.index}))},d(r.$t("delete")),9,z)]),e("td",null,[e("button",{class:"btn btn-secondary",disabled:l.isLoading,onClick:a[2]||(a[2]=o=>c({userDbId:l.user._id,userPermitID:l.user.permit_id,currentRole:l.user.role,newRole:l.user.role==="editor"?"moderator":"editor",index:l.index}))},d(l.user.role==="editor"?"Make Moderator":"Make Editor"),9,G)])]))}},K={class:"container my-5"},Q={class:"row mb-3"},W={class:"col-4"},X={class:"row"},Y={class:"table"},Z={class:"form-modal--header"},_={class:"form-modal--footer"},te={__name:"Users",setup(l){const{axiosCall:m,isLoading:f}=q(),i=C([]),g=y(document.getElementById("loading-line")),c=y(!1),r=y(null),a=y(null),o=y(null),b=y("new"),n=C({name:"",email:"",password:""}),U=C({size:"md",displayErrors:!1,schema:{name:{type:"text",inputType:"text",label:"Name",attrs:{autofocus:!0},rules:["required","min:2"],fieldName:"name"},email:{type:"text",inputType:"email",label:"Email",rules:["required","max:255","email"],fieldName:"email"},submit:{type:"button",submits:!0,buttonLabel:"Submit",full:!0}}});B(async()=>{try{g.value.classList.remove("hidden");const t=await m("GET","/users/get-all",{},{withCredentials:!0});t!=null&&t.success&&i.push(...t.data)}catch(t){h({type:"error",messages:t.message})}finally{g.value.classList.add("hidden")}});const T=async({user:t,index:s})=>{const u=await m("DELETE",`/users/delete/${t._id}/${t.permit_id}`,{},{withCredentials:!0});u!=null&&u.success&&(i.splice(s,1),h({type:"success",messages:u.message}))},D=async({userDbId:t,userPermitID:s,currentRole:u,newRole:v,index:w})=>{const V={user_permit_id:s,current_role:u,new_role:v},p=await m("PATCH",`/users/update-role/${t}`,V,{withCredentials:!0});p!=null&&p.success&&(i[w].role=v,h({type:"success",messages:p.message}))},x=F({get(){return n},set(t){Object.assign(n,t)}}),k=()=>{c.value=!1,n.name="",n.email="",n.password="",r.value=null,a.value=null,o.value=null,b.value="new"},P=async({user:t,index:s})=>{c.value=!0,n.name=t.name,n.email=t.email,r.value=t._id,a.value=s,o.value=t.permit_id,b.value="edit"},R=async()=>{let t;b.value==="new"?(n.password="123123",t=await m("POST","/users/create",n,{withCredentials:!0})):t=await m("PATCH",`/users/update/${r.value}/${o.value}`,n,{withCredentials:!0}),t!=null&&t.success&&(b.value==="new"?i.push({name:n.name,email:n.email,role:"moderator"}):(i[a.value].name=n.name,i[a.value].email=n.email),k(),h({type:"success",messages:t.message}))};return(t,s)=>{const u=M("Vueform");return H(),$(E,null,[e("div",K,[e("div",Q,[e("div",W,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=v=>c.value=!0)},d(t.$t("add_user")),1)])]),e("div",X,[e("table",Y,[e("thead",null,[e("tr",null,[e("th",null,d(t.$t("name")),1),s[2]||(s[2]=e("th",null,"Email",-1)),s[3]||(s[3]=e("th",null,"Role",-1)),s[4]||(s[4]=e("th",null,null,-1)),s[5]||(s[5]=e("th",null,null,-1)),s[6]||(s[6]=e("th",null,null,-1))])]),e("tbody",null,[(H(!0),$(E,null,I(i,(v,w)=>(H(),j(J,{key:w,index:w,user:v,isLoading:A(f),onDeleteHandler:T,onRoleHandler:D,onEditHandler:P},null,8,["index","user","isLoading"]))),128))])])])]),e("div",{class:L(["modal-backdrop",c.value?"show":""])},null,2),e("div",{class:L(["form-modal",c.value?"show":""])},[e("div",Z,[e("h3",null,d(b.value.toUpperCase())+" USER",1),e("button",{onClick:k,class:"btn-close"})]),e("div",_,[N(u,S(U,{endpoint:!1,onSubmit:R,modelValue:x.value,"onUpdate:modelValue":s[1]||(s[1]=v=>x.value=v),sync:""}),null,16,["modelValue"])])],2)],64)}}};export{te as default};
